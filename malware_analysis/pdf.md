# Malware Analysis - PDF

## High Level Workflow
1. Extract attachment from an email (.eml) - In cases where you obtained the entire email
1. Hash file and lookup - VirusTotal is your friend 
1. File Identification
1. Identify intereting names inside objects
1. Extract objects for closer examination
    
## MISC
  - What to do when a PDF is corrupted
  - Fastest way to find embedded URL in PDF

### The tool of choice is a malware analysis linux distro called Remnux 

## 0. Extract attachment from an email with "emldump"
```
emldump.py {filename}.eml //Identify the section of the email that has the attachment then extract...
emldump.py {filename}.eml -s {1-9} -d > {filename}.vir
```

## 00. Hash file and lookup on common sandboxes for existing analysis such as VT, Joe Sandbox to speed up your analysis
```
md5sum {filename}.vir
```
## 1. File Identification 
It is good practice to validate the type of file you are handling therefore a quick go-to tool is `file`
```
file {filename}.vir
```
## 2. Identify embedded objects with "peepdf.exe" to have a statistical view of what inside the PDF
Once you have confirmed you are handling a PDF, you should run `pdfid.py` to understand its structure and look for interesting objects that might contain malicious content at a high level
```
pdfid.py {filename}.vir
```
Then you could follow that with `peepdf` to have detail breakdown of the structure to hone in on your analysis.
```
peepdf {filename}.vir
```
Here's a list of common names that might bad actors can host malicious content
- /OpenAction
- /AA
- /Javascript
- /Js
- /AcroForm
- /XFA
- /URI
- /ObjStm
- /Submitform
- /XObject

When you see the value is not zero against these names then it might be worthwhile to take a closer look.

## Extract objects for closer examination
```
pdf-parser -o {1,N} -f -w {filename}.vir //specific location of objects
pdf-parser -s {object_name} {filename}.vir //search for specific name
```

### MISC
- A. Sometimes extract of PDF is corrupted and hinder analysis, use "pdftk" to repair.
```
pdftk {original_pdf_name}.pdf output {repaired_pdf_name}.pdf
```
- B. There are 2 quick ways to find domains/urls in PDF, 1) grep 2) use pdf-parser:
  - `grep -rai "http" {name}.pdf`
  - `pdf-parser -s URI {name}.pdf`

### Resource 
[https://intezer.com/blog/incident-response/analyze-malicious-pdf-files/]
[https://zeltser.com/media/docs/analyzing-malicious-document-files.pdf]
